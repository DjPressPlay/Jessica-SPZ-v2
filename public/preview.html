<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Zetsu Card â€” Schema-Accurate Renderer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="dark">
<style>
  /* (all your existing CSS unchanged) */
</style>
</head>
<body>

  <div class="frameType">
    <div id="inner" class="frameType-inner">
      <!-- Card structure same as before -->
      <div class="card-header">
        <div class="card-id" id="card-id"></div>
        <div class="card-name"><span id="card-name" class="autoscale"></span></div>
        <div class="card-icon" id="card-icon"></div>
      </div>
      <div class="card-art">
        <img id="card-image" alt="">
        <div class="stat-orb stat-blue"  id="level"></div>
        <div class="stat-orb stat-red"   id="atk"></div>
        <div class="stat-orb stat-green" id="def"></div>
      </div>
      <div class="type-banner">
        <div class="type-cell"><span id="tribute" class="autoscale"></span></div>
        <div class="type-about-wrap"><div class="type-about-box"><span id="about" class="type-about-text autoscale"></span></div></div>
        <div class="type-cell"><span id="type-emoji" class="autoscale"></span></div>
      </div>
      <div class="effect-box" id="effect-box"></div>
      <div class="meta-block">
        <div class="meta-line"><div class="meta-label">Sets -</div><div id="sets-line" class="meta-value"></div></div>
        <div class="meta-line"><div class="meta-label">Tags -</div><div id="tags-line" class="meta-value"></div></div>
      </div>
      <div class="meta-bottom">
        <div class="meta-footer-text" id="footer"></div>
        <div class="meta-timestamp" id="timestamp"></div>
        <div class="rarity" id="rarity"></div>
      </div>
    </div>
  </div>

<script>
/* ===== Helpers ===== */
const $ = id => document.getElementById(id);

function safeParse(json){
  try { return JSON.parse(json); } catch { return null; }
}
function getCardFromLink(){
  const p = new URLSearchParams(location.search);
  if (p.has("card")){
    const val = decodeURIComponent(p.get("card"));
    return safeParse(val);
  }
  return null;
}

/* ===== Frame/Stats (unchanged) ===== */
function applyFrame(card){ /* ... same code ... */ }
function computeStats(card){ /* ... same code ... */ }

/* ===== Render ===== */
function renderCard(card){
  applyFrame(card);
  $("card-id").textContent   = card.id || "";
  $("card-name").textContent = card.name || "";
  $("card-icon").textContent = card.icon || "";
  const img = $("card-image");
  img.src = (card.card_images && card.card_images[0] && card.card_images[0].image_url) || "";
  const stats = computeStats(card);
  $("level").textContent = stats.level;
  $("atk").textContent   = stats.atk;
  $("def").textContent   = stats.def;
  $("tribute").textContent    = stats.tributeString || card.tribute || "";
  $("about").textContent      = card.about || "";
  $("type-emoji").textContent = card.icon || "";
  const effBox = $("effect-box"); effBox.replaceChildren();
  (card.effects||[]).forEach(e=>{
    const entry = document.createElement("div"); entry.className="effect-entry";
    entry.innerHTML = `<div class="effect-bar"><div>${e.icons||""}</div><div>${e.emoji||""}</div></div><div class="effect-text">${e.text||""}</div>`;
    effBox.append(entry);
  });
  $("sets-line").textContent = (card.card_sets||[]).join(" ");
  $("tags-line").textContent = (card.tags||[]).join(" ");
  $("footer").textContent    = card.footer || "";
  $("timestamp").textContent = card.timestamp || "";
  const rb = $("rarity");
  rb.textContent = card.rarity || "";
  rb.className = "rarity " + (card.rarity || "");
}

/* ===== Boot ===== */
(function boot(){
  const card = getCardFromLink();
  if (!card) {
    document.querySelector('.frameType-inner').innerHTML =
      `<div style="padding:24px; text-align:center">No card found</div>`;
    return;
  }
  renderCard(card);
})();
</script>
</body>
</html>
