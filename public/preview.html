<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Zetsu Card — Schema-Accurate Renderer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="dark">
<style>
  :root{
    --frame-color:#e63946;
    --frame-outer:#000;
    --text:#fff;
  }
  body{
    margin:0; background:#111; color:var(--text);
    font-family:"Orbitron",system-ui,Segoe UI,Arial,Helvetica,sans-serif;
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
  }

  /* Frame */
  .frameType{
    position:relative; overflow:hidden;
    border:12px solid var(--frame-outer); border-radius:14px;
    width:clamp(360px, 92vw, 460px);
  }
  .frameType-inner{
    position:relative; overflow:hidden; border:6px solid var(--frame-color); border-radius:10px;
    background:#1a1a1a;
  }
  .frameType-inner::before{
    content:""; position:absolute; inset:0;
    background:radial-gradient(120% 100% at 50% 0%, #1e1e1e 0%, #0e0e0e 65%, #111 100%);
    z-index:0;
  }
  .card-header, .card-art, .type-banner, .effect-box, .meta-block, .meta-bottom { position:relative; z-index:1; }

  /* Header */
  .card-header{
    display:flex; justify-content:space-between; align-items:center;
    background:#000; padding:6px 10px; font-size:.9rem; font-weight:800; text-transform:uppercase;
    border-bottom:2px solid var(--frame-color); border-top-left-radius:8px; border-top-right-radius:8px;
  }
  .card-id{ background:#fff; color:#000; padding:2px 6px; border-radius:4px; font-size:.75rem; white-space:nowrap; }
  .card-name{ flex:1; min-width:0; display:flex; justify-content:center; align-items:center; text-align:center; }
  .card-name span{
    display:inline-block; max-width:100%; white-space:nowrap;
    overflow:visible; text-overflow:unset;
    transform:scale(var(--scale,1)); transform-origin:center center; line-height:1;
  }
  .card-icon{ font-size:1.1rem; text-align:right; min-width:1.5em; }

  /* Artwork */
  .card-art{
    position:relative; margin:10px; background:#222; aspect-ratio:4/3;
    border:3px solid var(--frame-color); border-radius:8px; overflow:hidden;
  }
  .card-art img{ width:100%; height:100%; object-fit:cover; display:block; }

  /* Stat orbs */
  .stat-orb{
    position:absolute; width:54px; height:54px; border-radius:50%;
    font-weight:800; font-size:1.02rem; display:flex; align-items:center; justify-content:center;
    border:3px solid #fff; box-shadow:0 2px 8px rgba(0,0,0,.4);
  }
  .stat-blue  { background:#3498db; top:6px;  left:6px; }
  .stat-red   { background:#e63946; bottom:6px; left:6px; }
  .stat-green { background:#2ecc71; bottom:6px; right:6px; }

  /* Type Banner (TRIBUTE | ABOUT | EMOJI) */
  .type-banner{
    background:#000; color:#fff; padding:6px 10px; font-weight:800;
    border-top:2px solid var(--frame-color); border-bottom:2px solid var(--frame-color);
    display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:8px;
  }
  .type-cell{ display:flex; justify-content:center; align-items:center; min-width:0; }
  .type-about-wrap{ display:flex; justify-content:center; align-items:center; min-width:0; }
  .type-about-box{
    display:inline-flex; align-items:center; justify-content:center;
    padding:4px 12px; border:2px solid var(--frame-color); border-radius:6px;
    background:#0b0b0b; box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
    max-width:100%;
  }
  .type-about-text{ font-size:.95rem; letter-spacing:.02em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:280px; }
  @media (max-width:480px){ .type-about-text{ max-width:200px; } }
  .truncate{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100%; }
  .autoscale{ display:inline-block; transform:scale(var(--scale,1)); transform-origin:center center; line-height:1; }

  /* Effects */
  .effect-box{
    background:#000; border-top:2px solid var(--frame-color); border-bottom:2px solid var(--frame-color);
    padding:10px; display:flex; flex-direction:column; gap:8px;
  }
  .effect-entry{ border:1px solid #2a2a2a; background:#0f0f0f; border-radius:8px; padding:8px 10px; }
  .effect-bar{ display:flex; justify-content:space-between; align-items:center; font-size:.92rem; margin-bottom:4px; }
  .effect-text{ font-size:.84rem; line-height:1.32; }

  /* Meta (Sets + Tags in one bracket) */
  .meta-block{
    border-top:2px solid var(--frame-color); border-bottom:2px solid var(--frame-color);
    background:#000; padding:8px 10px; display:flex; flex-direction:column; gap:6px;
  }
  .meta-line{ display:flex; gap:8px; align-items:center; font-size:.78rem; color:#ccc; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .meta-label{ font-weight:800; text-transform:uppercase; color:#eee; letter-spacing:.02em; }
  .meta-value{ flex:1; min-width:0; opacity:.95; }

  /* Bottom bar */
  .meta-bottom{
    position:relative; border-top:2px solid var(--frame-color);
    background:#111; padding:10px 12px 32px; text-align:center; color:#ccc;
  }
  .meta-footer-text{ font-size:.72rem; color:#cfcfcf; line-height:1.25; }
  .meta-timestamp{ margin-top:4px; font-size:.66rem; color:#9f9f9f; }
  .meta-bottom .rarity{
    position:absolute; right:10px; bottom:6px;
    font-weight:800; letter-spacing:.02em;
    border:1px solid rgba(255,255,255,.2); padding:2px 8px; border-radius:4px;
  }
  .rarity.SR{ background:#2d7bdc; }
  .rarity.UR{ background:#7c3aed; }
  .rarity.Q { background:#f1c40f; color:#111; }
  .rarity.ZEOE{
    color:#fff;
    background:conic-gradient(from 0deg, #ff0040, #ffd200, #00ffcc, #00a2ff, #ff4dff, #ff0040);
    background-size:200% 200%; animation:holoShift 6s linear infinite;
    border:1px solid rgba(255,255,255,.35); text-shadow:0 0 6px rgba(255,255,255,.35);
  }
  @keyframes holoShift{ 0%{background-position:0% 50%} 100%{background-position:200% 50%} }
  @media (prefers-reduced-motion: reduce){ .rarity.ZEOE{ animation:none; } }
</style>
</head>
<body>

  <div class="frameType">
    <div id="inner" class="frameType-inner">
      <!-- Header -->
      <div class="card-header">
        <div class="card-id" id="card-id"></div>
        <div class="card-name"><span id="card-name" class="autoscale"></span></div>
        <div class="card-icon" id="card-icon"></div>
      </div>

      <!-- Artwork -->
      <div class="card-art">
        <img id="card-image" alt="" loading="lazy" decoding="async">
        <div class="stat-orb stat-blue"  id="level"></div>
        <div class="stat-orb stat-red"   id="atk"></div>
        <div class="stat-orb stat-green" id="def"></div>
      </div>

      <!-- Type Banner -->
      <div class="type-banner">
        <div class="type-cell"><span id="tribute" class="autoscale truncate"></span></div>
        <div class="type-about-wrap"><div class="type-about-box"><span id="about" class="type-about-text autoscale truncate"></span></div></div>
        <div class="type-cell"><span id="type-emoji" class="autoscale truncate"></span></div>
      </div>

      <!-- Effects -->
      <div class="effect-box" id="effect-box"></div>

      <!-- Sets + Tags -->
      <div class="meta-block">
        <div class="meta-line"><div class="meta-label">Sets -</div><div id="sets-line" class="meta-value"></div></div>
        <div class="meta-line"><div class="meta-label">Tags -</div><div id="tags-line" class="meta-value"></div></div>
      </div>

      <!-- Footer / Timestamp / Rarity -->
      <div class="meta-bottom">
        <div class="meta-footer-text" id="footer"></div>
        <div class="meta-timestamp" id="timestamp"></div>
        <div class="rarity" id="rarity"></div>
      </div>
    </div>
  </div>

<script>
/* ===== Load card from localStorage ===== */
let card = null;
try {
  const stored = localStorage.getItem("jessica_card");
  if (stored) card = JSON.parse(stored);
} catch(e){ console.error("No valid jessica_card in storage", e); }

/* ===== Fallback if nothing in storage ===== */
if (!card) {
  card = {
    id:"000001234567", name:"Fallback Card", icon:"✨", about:"No Data",
    tribute:"🙇", effects:[], atk:"0", def:"0", level:"1", rarity:"Normal",
    tags:[], card_sets:[], timestamp:new Date().toISOString(),
    footer:"No saved card in localStorage", card_images:[]
  };
}

/* ===== Frame color maps ===== */
const colorPalette = { silver:"#C0C0C0", blue:"#0000FF", green:"#008000", gold:"#FFD700", maroon:"#800000" };
const card_type_map = { technology:{ color:"silver" }, science:{ color:"blue" }, sports:{ color:"green" }, business:{ color:"gold" } };
const rarityBorder = { Normal:{ color:"#aaa" }, Rare:{ color:"#ddd" }, SR:{ color:"#2d7bdc" }, UR:{ color:"#7c3aed" }, Quantum:{ color:"#f1c40f" }, ZEOE:{ iridescent:true } };

/* ===== Apply frame color / rarity ===== */
(function applyFrame(){
  const inner = document.getElementById("inner");
  let baseColor = "#e63946";
  const ft = String(card.frameType||"").toLowerCase();
  if (card_type_map[ft]) {
    const key = card_type_map[ft].color;
    if (colorPalette[key]) baseColor = colorPalette[key];
  }
  if (card.rarity && rarityBorder[card.rarity] && rarityBorder[card.rarity].color) {
    baseColor = rarityBorder[card.rarity].color;
  }
  document.documentElement.style.setProperty("--frame-color", baseColor);
})();

/* ===== Bind fields ===== */
const $ = id => document.getElementById(id);
$("card-id").textContent   = card.id || "";
$("card-name").textContent = card.name || "";
$("card-icon").textContent = card.icon || "";

/* Artwork */
const img = $("card-image");
img.src = card.card_images?.[0]?.image_url || "";
img.alt = card.name || "Card artwork";

/* Stats calc */
function countTributes(s){ return (s.match(/🙇/gu)||[]).length; }
function autoCalc(card){
  const tributeCount = card.tributes ?? countTributes(card.tribute);
  const level = tributeCount || Number(card.level) || 1;
  const atk = (level*1000) + ((card.effects?.length||0)*500);
  return { level, atk, def:Math.floor(atk/2) };
}
const stats = autoCalc(card);
$("level").textContent = stats.level;
$("atk").textContent   = stats.atk;
$("def").textContent   = stats.def;
$("tribute").textContent = "🙇‍♂️".repeat(card.tributes || countTributes(card.tribute));

/* Banner + meta */
$("about").textContent     = card.about   || "";
$("type-emoji").textContent= card.icon    || "";
$("sets-line").textContent = (card.card_sets||[]).join(" ");
$("tags-line").textContent = (card.tags||[]).join(" ");
$("footer").textContent    = card.footer  || "";
$("timestamp").textContent = card.timestamp || "";
const rb=$("rarity"); rb.textContent=card.rarity||"";
</script>
</body>
</html>
