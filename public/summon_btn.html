<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Summon — Zetsu Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="dark">
<link rel="stylesheet" href="summon_style.css" />
</head>
<body>

  <div class="frameType">
    <div id="inner" class="frameType-inner">
      <!-- Header -->
      <div class="card-header" role="group" aria-label="Card header">
        <div class="card-id" id="card-id" aria-label="Card ID"></div>
        <div class="card-name" aria-live="polite">
          <span id="card-name" class="autoscale" dir="auto"></span>
        </div>
        <div class="card-icon" id="card-icon" aria-hidden="true"></div>
      </div>

      <!-- Artwork -->
      <div class="card-art">
        <img id="card-image" alt="" loading="lazy" decoding="async">
        <div class="stat-orb stat-blue"  id="level"></div>
        <div class="stat-orb stat-red"   id="atk"></div>
        <div class="stat-orb stat-green" id="def"></div>
      </div>

      <!-- Type Banner -->
      <div class="type-banner">
        <div class="type-cell"><span id="tribute" class="autoscale truncate" dir="auto"></span></div>
        <div class="type-about-wrap">
          <div class="type-about-box">
            <span id="about" class="type-about-text autoscale truncate" dir="auto"></span>
          </div>
        </div>
        <div class="type-cell"><span id="type-emoji" class="autoscale truncate" dir="auto"></span></div>
      </div>

      <!-- Effects -->
      <div class="effect-box" id="effect-box"></div>

      <!-- Sets + Tags -->
      <div class="meta-block">
        <div class="meta-line"><div class="meta-label">Sets -</div><div id="sets-line" class="meta-value"></div></div>
        <div class="meta-line"><div class="meta-label">Tags -</div><div id="tags-line" class="meta-value"></div></div>
      </div>

      <!-- Footer / Timestamp / Rarity -->
      <div class="meta-bottom">
        <div class="meta-footer-text" id="footer"></div>
        <div class="meta-timestamp" id="timestamp"></div>
        <div class="rarity" id="rarity"></div>
      </div>
    </div>
  </div>

<script>
/* ===== Render-Only Summon ===== */
/* Pull exactly what Preview/Index saved. Do NOT compute or mutate. */

let card = null;
try {
  const raw = localStorage.getItem("jessica_card");
  if (raw) card = JSON.parse(raw);
} catch (e) {
  console.warn("Could not parse jessica_card:", e);
}

if (!card) {
  // Minimal fallback so page doesn't break if nothing is saved yet
  card = {
    id: "-",
    name: "No Card Found",
    icon: "❌",
    about: "",
    tribute: "",
    effects: [],
    atk: "",
    def: "",
    level: "",
    rarity: "Normal",
    tags: [],
    card_sets: [],
    timestamp: "",
    footer: "No saved card in localStorage",
    card_images: [],
    frameType: ""
  };
}

/* ===== Visual frame tint only (no data mutation) ===== */
const colorPalette = {
  silver:"#C0C0C0", blue:"#0000FF", "dark-blue":"#00008B", green:"#008000",
  gold:"#FFD700", maroon:"#800000", "bright-red":"#FF4949", "sky-blue":"#87CEEB",
  teal:"#008080", cyan:"#00FFFF", magenta:"#FF00FF", "red-orange":"#FF4500",
  "sky-blue-light":"#ADD8E6", "forest-green":"#228B22", orange:"#FFA500",
  "light-green":"#90EE90", violet:"#EE82EE", "dark-violet":"#9400D3", peach:"#FFDAB9",
  "gray-gradient":"#D3D3D3", beige:"#F5F5DC", "yellow-green":"#9ACD32", black:"#000000",
  "light-gray":"#D3D3D3", rose:"#FFC0CB", "neon-yellow":"#FFFF00", "peach-light":"#FFDAB9",
  "dark-red":"#8B0000", gray:"#808080", "black-red-holo":"#8B0000", purple:"#6A0DAD",
  "neon-multicolor":"#FF00FF"
};
const card_type_map = {
  technology:{ color:"silver" }, science:{ color:"blue" }, investigative:{ color:"dark-blue" },
  sports:{ color:"green" }, business:{ color:"gold" }
};
const rarityBorder = {
  Normal:{ color:"#aaa", iridescent:false }, Rare:{ color:"#ddd", iridescent:false },
  SR:{ color:"#2d7bdc", iridescent:false }, UR:{ color:"#7c3aed", iridescent:false },
  Quantum:{ color:"#f1c40f", iridescent:false }, ZEOE:{ color:null, iridescent:true }
};

(function applyFrame(){
  const inner = document.getElementById("inner");
  let baseColor = "#e63946";
  const ft = String(card.frameType || "").toLowerCase().replace(/\s+/g, "_");
  if (card_type_map[ft]) {
    const key = card_type_map[ft].color;
    if (colorPalette[key]) baseColor = colorPalette[key];
  }
  let useIri = false;
  const r = card.rarity;
  if (r && rarityBorder[r]) {
    if (rarityBorder[r].iridescent) useIri = true;
    else if (rarityBorder[r].color) baseColor = rarityBorder[r].color;
  }
  document.documentElement.style.setProperty("--frame-color", baseColor);
  inner.classList.toggle("iridescent", useIri);
})();

/* ===== Bind helpers (render-only) ===== */
const $ = id => document.getElementById(id);
const set = (id, v) => { const el = $(id); if (el) el.textContent = (v ?? ""); };

/* Header */
set("card-id", card.id);
set("card-name", card.name);
set("card-icon", card.icon);

/* Artwork */
const img = $("card-image");
if (img) {
  const url = card.card_images?.[0]?.image_url || "";
  img.src = url;
  img.alt = card.name ? `${card.name} — artwork` : "Card artwork";
}

/* Stats — EXACT values from saved card */
set("level", card.level);
set("atk", card.atk);
set("def", card.def);

/* Type banner — show tribute string exactly as saved */
set("tribute", card.tribute);
set("about", card.about);
set("type-emoji", card.icon);

/* Effects */
const effBox = $("effect-box");
if (effBox) {
  effBox.replaceChildren();
  (card.effects || []).forEach(e => {
    const entry = document.createElement("div"); entry.className = "effect-entry";
    const bar   = document.createElement("div"); bar.className   = "effect-bar";
    const icons = document.createElement("div"); icons.textContent = e.icons || "";
    const emj   = document.createElement("div"); emj.textContent   = e.emoji || "";
    bar.append(icons, emj);
    const text  = document.createElement("div"); text.className = "effect-text";
    text.textContent = e.text || "";
    entry.append(bar, text);
    effBox.append(entry);
  });
}

/* Meta */
set("sets-line", Array.isArray(card.card_sets) ? card.card_sets.join(" ") : "");
set("tags-line", Array.isArray(card.tags) ? card.tags.join(" ") : "");
set("footer", card.footer);
set("timestamp", card.timestamp);

/* Rarity badge */
const rb = $("rarity");
if (rb) {
  rb.textContent = card.rarity || "";
  const rarityClassMap = { Normal:"Normal", Rare:"Rare", SR:"SR", UR:"UR", Quantum:"Q", ZEOE:"ZEOE" };
  rb.classList.add(rarityClassMap[card.rarity] || (card.rarity || ""));
}

/* ===== Visual autoscale only (no data changes) ===== */
function autoscaleToLength(el, maxChars, minScale = 0.6){
  if(!el) return; el.style.setProperty('--scale','1');
  const len = [...(el.textContent || '').trim()].length;
  el.style.setProperty('--scale', String(len > maxChars ? Math.max(minScale, maxChars / len) : 1));
}
function autoshrinkFontToFit(el, { min=0.50, pad=4, squeezeLeft=null, squeezeRight=null, squeezePx=6 } = {}){
  if (!el || !el.parentElement) return;
  const base = parseFloat(el.dataset.baseFs || getComputedStyle(el).fontSize) || 14;
  el.dataset.baseFs = base; el.style.fontSize = base + 'px';
  if (squeezeLeft)  squeezeLeft.style.marginRight  = '';
  if (squeezeRight) squeezeRight.style.marginLeft  = '';
  let avail = Math.max(1, el.parentElement.clientWidth - pad);
  if (el.scrollWidth <= avail) return;
  if (squeezeLeft)  squeezeLeft.style.marginRight  = `-${squeezePx}px`;
  if (squeezeRight) squeezeRight.style.marginLeft  = `-${squeezePx}px`;
  avail = Math.max(1, el.parentElement.clientWidth - pad);
  const scale = Math.max(min, avail / el.scrollWidth);
  el.style.fontSize = (base * scale) + 'px';
}
function applyAutoscaleAll(){
  autoscaleToLength($('tribute'), 10, 0.6);
  autoscaleToLength($('type-emoji'), 8, 0.6);
  autoscaleToLength($('about'), 20, 0.75);
  const nameSpan = document.querySelector('.card-name span');
  autoshrinkFontToFit(nameSpan, {
    min:0.50, pad:4,
    squeezeLeft:  document.querySelector('.card-id'),
    squeezeRight: $('card-icon'),
    squeezePx:6
  });
}
applyAutoscaleAll();
if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(applyAutoscaleAll).catch(()=>{});
}
let rafId = null;
addEventListener('resize', () => {
  if (rafId) cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(() => { applyAutoscaleAll(); rafId = null; });
});
</script>
</body>
</html>
